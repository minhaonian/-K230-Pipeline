<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸ¹æ­£ä¸­å­¸ K230_YOLOv8 äº’å‹•å¯¦é©—å®¤</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --code-bg-base: #1e1e1e;     
            --code-bg-active: #323639;   
            --code-text: #d4d4d4;
            --code-text-dim: #999999;    
            --highlight-color: #ffd700;
            --panel-bg: #ffffff;
            --junior-accent: #007bff;
            --senior-accent: #6f42c1;
            --senior-bg-light: #f3e5f5;
            --border-radius: 12px;
        }

        /* 1. ä½ˆå±€ä¿®å¾©ï¼šç¢ºä¿ Body ä¸æ»¾å‹•ï¼Œé«˜åº¦å›ºå®š */
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 15px;
            height: 100vh; /* å¼·åˆ¶å…¨å±é«˜åº¦ */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* ç¦æ­¢æ•´å€‹é é¢å‡ºç¾æ»¾å‹•æ¢ */
        }

        header { 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px; 
            flex-shrink: 0; /* é˜²æ­¢ header è¢«å£“ç¸® */
            padding: 5px 0;
        }
        
        /* ç´” CSS/SVG èŠ¯ç‰‡åœ–æ¨™æ¨£å¼ */
        .chip-icon {
            width: 50px;
            height: 50px;
            background: #2c3e50;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chip-icon::before {
            content: "K230";
            color: #ffd700;
            font-weight: bold;
            font-family: monospace;
            font-size: 12px;
            z-index: 2;
        }
        /* èŠ¯ç‰‡å¼•è…³è£é£¾ */
        .chip-pin {
            position: absolute;
            background: #95a5a6;
        }
        .pin-h { width: 6px; height: 2px; }
        .pin-v { width: 2px; height: 6px; }
        
        /* ä¸Šä¸‹å¼•è…³ */
        .chip-icon .pin-v:nth-child(1) { top: -4px; left: 10px; }
        .chip-icon .pin-v:nth-child(2) { top: -4px; left: 24px; }
        .chip-icon .pin-v:nth-child(3) { top: -4px; left: 38px; }
        .chip-icon .pin-v:nth-child(4) { bottom: -4px; left: 10px; }
        .chip-icon .pin-v:nth-child(5) { bottom: -4px; left: 24px; }
        .chip-icon .pin-v:nth-child(6) { bottom: -4px; left: 38px; }
        /* å·¦å³å¼•è…³ */
        .chip-icon .pin-h:nth-child(7) { left: -4px; top: 10px; }
        .chip-icon .pin-h:nth-child(8) { left: -4px; top: 24px; }
        .chip-icon .pin-h:nth-child(9) { left: -4px; top: 38px; }
        .chip-icon .pin-h:nth-child(10) { right: -4px; top: 10px; }
        .chip-icon .pin-h:nth-child(11) { right: -4px; top: 24px; }
        .chip-icon .pin-h:nth-child(12) { right: -4px; top: 38px; }
        
        /* èŠ¯ç‰‡å…§éƒ¨æ ¸å¿ƒ */
        .chip-core {
            position: absolute;
            width: 30px;
            height: 30px;
            border: 1px solid #ffd700;
            border-radius: 4px;
            background: rgba(255, 215, 0, 0.1);
        }

        h1 { 
            margin: 0; 
            color: #2c3e50; 
            font-size: 1.6rem; 
            line-height: 1.2;
        }

        /* 2. ä½ˆå±€ä¿®å¾©ï¼šFlex å®¹å™¨é™åˆ¶ */
        .main-container {
            display: flex;
            flex: 1; /* ä½”æ“šå‰©é¤˜ç©ºé–“ */
            gap: 20px;
            min-height: 0; /* é—œéµï¼é˜²æ­¢å­å…ƒç´ æ’ç ´ Flex å®¹å™¨ï¼Œè®“å…§éƒ¨æ»¾å‹•æ¢ç”Ÿæ•ˆ */
            height: 100%;
        }

        /* --- å·¦å´ä»£ç¢¼å€ --- */
        .code-panel {
            flex: 6;
            background-color: var(--code-bg-base);
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* å…§éƒ¨æ»¾å‹• */
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #333;
        }

        .panel-header {
            background: #252526;
            padding: 10px 15px;
            color: #fff;
            font-size: 0.9rem;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .code-scroll-area {
            flex: 1;
            overflow-y: auto; /* ç¢ºä¿é€™è£¡å¯ä»¥æ»¾å‹• */
            padding: 10px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: var(--code-text);
            white-space: pre;
            scroll-behavior: smooth;
            background-color: #121212;
        }

        .code-block {
            padding: 12px 15px;
            cursor: pointer;
            border-left: 4px solid #333;
            margin: 2px 0;
            background-color: var(--code-bg-base);
            transition: all 0.2s ease-out;
            position: relative;
            opacity: 0.85; 
            color: var(--code-text-dim);
        }

        .code-block:hover { 
            background-color: #2a2d2e;
            opacity: 1;
            color: var(--code-text);
        }

        .code-block.active {
            opacity: 1;
            color: #fff;
            background-color: var(--code-bg-active);
            border-left: 6px solid var(--highlight-color);
            border-top: 1px solid #444;
            border-bottom: 1px solid #444;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.5); 
            z-index: 10;
            transform: scale(1.005);
        }

        .code-block.active::after {
            content: "â—€ Reading";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--highlight-color);
            font-size: 12px;
            font-weight: bold;
            opacity: 0.8;
            pointer-events: none;
        }

        .code-line {
            display: block;
            width: 100%;
            border-radius: 2px;
        }

        /* æŒä¹…é«˜äº®æ¨£å¼ */
        .persistent-highlight { 
            background-color: rgba(255, 215, 0, 0.9) !important; 
            color: #000 !important; 
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            font-weight: bold;
        }

        .ln { 
            color: #555; 
            display: inline-block; 
            width: 35px; 
            text-align: right; 
            margin-right: 15px; 
            user-select: none; 
            font-size: 12px; 
            border-right: 1px solid #444;
            padding-right: 8px;
        }
        
        .code-block.active .ln { color: #ddd; border-right-color: var(--highlight-color); }
        
        /* --- å³å´è§£èªªå€ --- */
        .info-panel {
            flex: 4;
            background-color: var(--panel-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-y: auto; /* ç¢ºä¿é€™è£¡å¯ä»¥æ»¾å‹• */
            border: 1px solid #e0e0e0;
            position: relative;
            height: 100%; /* ç¢ºä¿é«˜åº¦å¡«æ»¿çˆ¶å®¹å™¨ */
            box-sizing: border-box; /* åŒ…å« padding */
        }

        .info-content { animation: fadeIn 0.3s ease-in-out; padding-bottom: 50px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .info-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
            background: #ffd700;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .info-title { font-size: 1.5rem; color: #222; margin: 0 0 15px 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .junior-section {
            font-size: 1.05rem;
            color: #444;
            line-height: 1.7;
        }

        .concept-card {
            background: #f8f9fa;
            border-left: 5px solid var(--junior-accent);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .concept-card h4 { margin: 0 0 8px 0; color: var(--junior-accent); display: flex; align-items: center; gap: 8px; font-size: 1.1rem; }

        /* ğŸŸª é«˜ä¸­ç”Ÿå€å¡Š */
        .senior-wrapper {
            margin-top: 25px;
            border-top: 1px dashed #ccc;
            padding-top: 15px;
        }

        .senior-toggle {
            background-color: white;
            border: 1px solid var(--senior-accent);
            color: var(--senior-accent);
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 0.95rem;
            width: 100%;
            box-sizing: border-box;
        }

        .senior-toggle:hover {
            background-color: var(--senior-bg-light);
            box-shadow: 0 2px 5px rgba(111, 66, 193, 0.2);
        }

        .senior-toggle::after {
            content: 'â–¼';
            font-size: 0.8rem;
            transition: transform 0.3s;
        }
        .senior-toggle.open::after { transform: rotate(180deg); }

        .senior-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            background-color: #fafafa;
            border-radius: 0 0 8px 8px;
            margin-top: 5px;
        }

        .senior-inner {
            padding: 15px;
            border: 1px solid #eee;
            border-top: none;
            color: #555;
            font-size: 0.95rem;
            line-height: 1.7;
        }

        .senior-inner h4 { margin: 0 0 10px 0; color: var(--senior-accent); font-size: 1rem; }
        
        /* äº’å‹•é—œéµè© */
        .interactive-keyword {
            color: #d35400;
            background-color: #fff5e6;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            border: 1px solid #f5c6cb;
            transition: all 0.2s;
            display: inline-block;
            margin: 0 2px;
        }
        .interactive-keyword:hover {
            background-color: #d35400;
            color: white;
            border-color: #d35400;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 4px; }
        .code-scroll-area::-webkit-scrollbar-track { background: #1e1e1e; }
        .code-scroll-area::-webkit-scrollbar-thumb { background: #555; }
    </style>
</head>
<body>

    <header>
        <!-- ç´” CSS ç¹ªè£½çš„èŠ¯ç‰‡åœ–æ¨™ -->
        <div class="chip-icon">
            <div class="chip-core"></div>
            <div class="pin-v chip-pin"></div><div class="pin-v chip-pin"></div><div class="pin-v chip-pin"></div>
            <div class="pin-v chip-pin"></div><div class="pin-v chip-pin"></div><div class="pin-v chip-pin"></div>
            <div class="pin-h chip-pin"></div><div class="pin-h chip-pin"></div><div class="pin-h chip-pin"></div>
            <div class="pin-h chip-pin"></div><div class="pin-h chip-pin"></div><div class="pin-h chip-pin"></div>
        </div>
        <h1>åŸ¹æ­£ä¸­å­¸ K230_YOLOv8 äº’å‹•å¯¦é©—å®¤</h1>
    </header>

    <div class="main-container">
        <div class="code-panel">
            <div class="panel-header">
                <span>ğŸ“„ YOLOv8æ£€æµ‹ç¤ºä¾‹.py</span>
                <span>Python</span>
            </div>
            <div class="code-scroll-area" id="code-container"></div>
        </div>

        <div class="info-panel" id="info-panel">
            <div style="text-align: center; color: #999; margin-top: 40%;">
                <h3>ğŸ‘ˆ è«‹é»æ“Šå·¦å´ä»£ç¢¼å¡Šé–‹å§‹å­¸ç¿’</h3>
                <p>ä»£ç¢¼å°‡æœƒé«˜äº®é¡¯ç¤ºï¼Œè§£èªªå°‡åœ¨æ­¤è™•å‘ˆç¾</p>
            </div>
        </div>
    </div>

    <script>
        function key(text, targetText = null) {
            // è™•ç†æœç´¢è©ï¼Œè½‰ç¾©å¼•è™Ÿï¼Œç¢ºä¿ JS å­—ç¬¦ä¸²æ­£ç¢º
            const search = (targetText || text).replace(/'/g, "\\'"); 
            return `<span class="interactive-keyword" onclick="highlightCode('${search}')">${text}</span>`;
        }

        const codeChunks = [
            {
                id: "imports_nms",
                lines: [
                    "import os,sys",
                    "from media.sensor import *",
                    "from media.display import *",
                    "from media.media import *",
                    "import nncase_runtime as nn",
                    "import ulab.numpy as np",
                    "import time,image,random,gc",
                    "from libs.Utils import *",
                    "",
                    "#-----------------------------å…¶ä»–å¿…è¦æ–¹æ³•---------------------------------------------",
                    "# å¤šç›®æ ‡æ£€æµ‹ éæœ€å¤§å€¼æŠ‘åˆ¶æ–¹æ³•å®ç°",
                    "def nms(boxes,scores,thresh):",
                    "    \"\"\"Pure Python NMS baseline.\"\"\"",
                    "    x1,y1,x2,y2 = boxes[:, 0],boxes[:, 1],boxes[:, 2],boxes[:, 3]",
                    "    areas = (x2 - x1 + 1) * (y2 - y1 + 1)",
                    "    order = np.argsort(scores,axis = 0)[::-1]",
                    "    keep = []",
                    "    while order.size > 0:",
                    "        # ... (NMS ç®—æ³•å¯¦ç¾ä»£ç¢¼çœç•¥ä»¥ç¯€çœç©ºé–“) ...",
                    "    return keep"
                ],
                title: "1. æº–å‚™å·¥å…·èˆ‡ NMS ç®—æ³•",
                badge: "åŸºç¤æº–å‚™",
                juniorContent: `
                    <p class="info-text">
                        ç¨‹å¼çš„ä¸€é–‹å§‹ï¼Œæˆ‘å€‘å…ˆæŠŠå·¥å…·ç®±æ‹¿å‡ºä¾†ã€‚
                        ${key('nncase_runtime')} æ˜¯ç”¨ä¾†æ§åˆ¶ AI èŠ¯ç‰‡çš„ï¼Œ
                        ${key('media')} æ˜¯æ§åˆ¶æ”åƒé ­å’Œå±å¹•çš„ã€‚
                    </p>
                    <div class="concept-card">
                        <h4>ğŸ“ ${key('nms', 'def nms')} (éæ¥µå¤§å€¼æŠ‘åˆ¶) æ˜¯ä»€éº¼ï¼Ÿ</h4>
                        <p>æƒ³åƒä¸€ä¸‹ï¼ŒAI çœ‹åˆ°ä¸€éš»ç‹—ï¼Œå®ƒå¯èƒ½æœƒæ¿€å‹•åœ°ç•«å‡º 10 å€‹æ¡†æ¡†èªªã€Œé€™è£¡æ˜¯ç‹—ï¼ã€ã€‚</p>
                        <p><b>NMS å°±åƒä¸€ä½åš´æ ¼çš„è€å¸«</b>ï¼Œå®ƒæœƒæª¢æŸ¥é€™äº›æ¡†æ¡†ï¼š</p>
                        <ul>
                            <li>å¦‚æœå¹¾å€‹æ¡†æ¡†é‡ç–Šå¤ªå¤šï¼Œå®ƒåªæœƒä¿ç•™åˆ†æ•¸æœ€é«˜ï¼ˆæœ€æº–ç¢ºï¼‰çš„é‚£ä¸€å€‹ã€‚</li>
                            <li>æŠŠå…¶ä»–å¤šé¤˜çš„æ¡†æ¡†åˆªæ‰ï¼Œè®“ç•«é¢è®Šä¹¾æ·¨ã€‚</li>
                        </ul>
                    </div>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ æ•¸å­¸åŸç†ï¼šIoU èˆ‡ çŸ©é™£åˆ‡ç‰‡</h4>
                    <p><b>1. IoU (Intersection over Union)ï¼š</b><br>
                    NMS çš„æ ¸å¿ƒæ•¸å­¸æ˜¯è¨ˆç®—å…©å€‹çŸ©å½¢æ¡†çš„äº¤é›†é¢ç©é™¤ä»¥è¯é›†é¢ç©ã€‚ç•¶ IoU > é–¾å€¼æ™‚ï¼Œæˆ‘å€‘è¦–ç‚ºé‡è¤‡åµæ¸¬ã€‚</p>
                    <p><b>2. å‘é‡åŒ–æ“ä½œï¼š</b><br>
                    ä»£ç¢¼ä¸­çš„ ${key('boxes[:, 0]')} ä½¿ç”¨äº† Numpy çš„åˆ‡ç‰‡èªæ³•ã€‚é€™æ¯”ç”¨ for è¿´åœˆä¸€å€‹å€‹è®€å–å¿«å¾—å¤šï¼Œé€™åœ¨ Python æ•¸æ“šç§‘å­¸ä¸­ç¨±ç‚ºã€Œå‘é‡åŒ–é‹ç®—ã€ï¼Œèƒ½å¤§å¹…æå‡åµŒå…¥å¼è¨­å‚™çš„æ•ˆç‡ã€‚
                    åŒæ™‚ä½¿ç”¨äº† ${key('np.argsort')} ä¾†å°åˆ†æ•¸é€²è¡Œå¿«é€Ÿæ’åºã€‚</p>
                `
            },
            {
                id: "letterbox",
                lines: [
                    "",
                    "# è®¡ç®—paddingç¼©æ”¾æ¯”ä¾‹å’Œä¸Šä¸‹å·¦å³paddingå¤§å°",
                    "def letterbox_pad_param(input_size,output_size):",
                    "    ratio_w = output_size[0] / input_size[0]  # å®½åº¦ç¼©æ”¾æ¯”ä¾‹",
                    "    ratio_h = output_size[1] / input_size[1]   # é«˜åº¦ç¼©æ”¾æ¯”ä¾‹",
                    "    ratio = min(ratio_w, ratio_h)  # å–è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹",
                    "    new_w = int(ratio * input_size[0])  # æ–°å®½åº¦",
                    "    new_h = int(ratio * input_size[1])  # æ–°é«˜åº¦",
                    "    dw = (output_size[0] - new_w) / 2  # å®½åº¦å·®",
                    "    dh = (output_size[1] - new_h) / 2  # é«˜åº¦å·®",
                    "    top = int(round(0))",
                    "    bottom = int(round(dh * 2 + 0.1))",
                    "    left = int(round(0))",
                    "    right = int(round(dw * 2 - 0.1))",
                    "    return top, bottom, left, right,ratio"
                ],
                title: "2. åœ–ç‰‡ä¸è®Šå½¢è¡“ (Letterbox)",
                badge: "åœ–åƒæ•¸å­¸",
                juniorContent: `
                    <p class="info-text">
                        AI æ¨¡å‹é€šå¸¸éœ€è¦æ­£æ–¹å½¢çš„åœ–ç‰‡ï¼ˆä¾‹å¦‚ 224x224ï¼‰ï¼Œä½†æˆ‘å€‘çš„æ”åƒé ­æ‹å‡ºä¾†çš„æ˜¯é•·æ–¹å½¢ï¼ˆ1280x720ï¼‰ã€‚
                    </p>
                    <div class="concept-card">
                        <h4>ğŸ–¼ï¸ ${key('letterbox_pad_param')} æ€éº¼æŠŠé•·æ–¹å½¢å¡é€²æ­£æ–¹å½¢ï¼Ÿ</h4>
                        <p>å¦‚æœç›´æ¥æ‹‰ä¼¸ï¼Œç‰©é«”æœƒè®Šå½¢ï¼ˆäººæœƒè®Šç˜¦é•·ï¼‰ã€‚</p>
                        <p><b>Letterbox</b> å‡½æ•¸çš„ä½œç”¨æ˜¯ï¼š</p>
                        <ol>
                            <li>æŒ‰æ¯”ä¾‹ç¸®å°åœ–ç‰‡ï¼Œä¿æŒåŸæ¨£ (è¨ˆç®— ${key('ratio')})ã€‚</li>
                            <li>åœ¨å¤šå‡ºä¾†çš„ç©ºéš™ï¼ˆé€šå¸¸æ˜¯ç°è‰²æˆ–é»‘è‰²ï¼‰é€²è¡Œå¡«å…… (${key('dw')}, ${key('dh')})ã€‚</li>
                        </ol>
                        <p>é€™æ¨£ AI çœ‹åˆ°çš„ç‰©é«”å½¢ç‹€æ‰æ˜¯æ­£å¸¸çš„ï¼</p>
                    </div>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ æ•¸å­¸åŸç†ï¼šä»¿å°„è®Šæ›é å‚™</h4>
                    <p><b>1. ç¸®æ”¾å› å­ï¼š</b><br>
                    æˆ‘å€‘è¨ˆç®— ${key('ratio = min')}ã€‚é€™ä¿è­‰äº†åœ–åƒèƒ½å®Œæ•´å¡å…¥ç›®æ¨™å¼µé‡ï¼Œä¸”ä¸æœƒè¶…å‡ºé‚Šç•Œã€‚</p>
                    <p><b>2. Padding çš„æ„ç¾©ï¼š</b><br>
                    ${key('dw')} å’Œ ${key('dh')} ä»£è¡¨äº†åœ–åƒåœ¨ç›®æ¨™å¼µé‡ä¸­çš„<b>åç§»é‡ (Offset)</b>ã€‚é€™åœ¨å¾ŒçºŒå°‡ AI é æ¸¬çš„åæ¨™é‚„åŸå›åŸåœ–æ™‚éå¸¸é‡è¦ï¼Œæˆ‘å€‘éœ€è¦åŸ·è¡Œä¸€å€‹é€†è®Šæ›ï¼š<code>åŸåœ–åæ¨™ = (é æ¸¬åæ¨™ - Offset) / ratio</code>ã€‚</p>
                `
            },
            {
                id: "sensor_display",
                lines: [
                    "",
                    "#-----------------------------Sensor/Displayåˆå§‹åŒ–éƒ¨åˆ†-------------------------------",
                    "DISPLAY_WIDTH = ALIGN_UP(1920, 16)",
                    "DISPLAY_HEIGHT = 1080",
                    "AI_RGB888P_WIDTH = ALIGN_UP(1280, 16)",
                    "AI_RGB888P_HEIGHT = 720",
                    "",
                    "sensor = Sensor()",
                    "sensor.reset()",
                    "#sensor.set_hmirror(False)",
                    "#sensor.set_vflip(False)",
                    "",
                    "# é€šé“0ç›´æ¥ç»™åˆ°æ˜¾ç¤ºVOï¼Œæ ¼å¼ä¸ºYUV420",
                    "sensor.set_framesize(width = DISPLAY_WIDTH, height = DISPLAY_HEIGHT,chn=CAM_CHN_ID_0)",
                    "sensor.set_pixformat(Sensor.YUV420SP,chn=CAM_CHN_ID_0)",
                    "# é€šé“1ç»™åˆ°AIåšç®—æ³•å¤„ç†ï¼Œæ ¼å¼ä¸ºRGB888P",
                    "sensor.set_framesize(width = AI_RGB888P_WIDTH , height = AI_RGB888P_HEIGHT, chn=CAM_CHN_ID_1)",
                    "sensor.set_pixformat(Sensor.RGBP888, chn=CAM_CHN_ID_1)",
                    "",
                    "# ç»‘å®šé€šé“0çš„æ‘„åƒå¤´å›¾åƒåˆ°å±å¹•",
                    "sensor_bind_info = sensor.bind_info(x = 0, y = 0, chn = CAM_CHN_ID_0)",
                    "Display.bind_layer(**sensor_bind_info, layer = Display.LAYER_VIDEO1)",
                    "",
                    "# OSDå›¾åƒåˆå§‹åŒ–,åˆ›å»ºä¸€å¸§å’Œå±å¹•åˆ†è¾¨ç‡åŒæ ·å¤§çš„é€æ˜å›¾åƒ",
                    "osd_img = image.Image(DISPLAY_WIDTH, DISPLAY_HEIGHT, image.ARGB8888)",
                    "",
                    "Display.init(Display.LT9611,width=DISPLAY_WIDTH,height=DISPLAY_HEIGHT,osd_num=1, to_ide = True)",
                    "sensor._set_chn_fps(chn = CAM_CHN_ID_0, fps = Display.fps())"
                ],
                title: "3. å–šé†’çœ¼ç›èˆ‡å±å¹• (Sensor & Display)",
                badge: "K230 æ ¸å¿ƒç‰¹è‰²",
                juniorContent: `
                    <p class="info-text">
                        é€™æ˜¯ K230 æœ€å²å®³çš„åœ°æ–¹ï¼å®ƒæœ‰ã€Œåˆ†èº«è¡“ã€ã€‚
                    </p>
                    <div class="concept-card">
                        <h4>ğŸ‘€ é›™é€šé“ (Dual Channel) åŸç†</h4>
                        <p>${key('Sensor()')} (æ”åƒé ­) åŒæ™‚ç”¢ç”Ÿå…©è·¯ç•«é¢ï¼š</p>
                        <ul>
                            <li><b>${key('CAM_CHN_ID_0')} (1920x1080)</b>ï¼šç›´æ¥é€åˆ°å±å¹•çµ¦ä½ çœ‹ã€‚é€™æ¢è·¯ä¸ç¶“é CPUï¼Œæ‰€ä»¥å°±ç®— AI ç®—å¾—æ…¢ï¼Œç•«é¢ä¹Ÿçµ•å°ä¸å¡é “ï¼</li>
                            <li><b>${key('CAM_CHN_ID_1')} (1280x720)</b>ï¼šé€åˆ°å¾Œå°çµ¦ AI é€²è¡Œåˆ†æã€‚</li>
                        </ul>
                    </div>
                    <p class="info-text">
                        ${key('Display.bind_layer')} å°±æ˜¯æŠŠæ”åƒé ­å’Œå±å¹•ç›´æ¥é€£èµ·ä¾†ã€‚
                        <br>æˆ‘å€‘é‚„å‰µå»ºäº†ä¸€å€‹ ${key('osd_img', 'osd_img = image.Image')}ï¼Œé€™æ˜¯ä¸€å¼µ<b>é€æ˜çš„ç»ç’ƒç´™</b>ï¼Œæˆ‘å€‘ç¨å¾ŒæœƒæŠŠç´…æ¡†æ¡†ç•«åœ¨é€™å¼µç´™ä¸Šï¼Œç„¶å¾Œè²¼åœ¨å±å¹•æœ€ä¸Šå±¤ã€‚
                    </p>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ ç¡¬é«”åŸç†ï¼šè¨˜æ†¶é«”å°é½Šèˆ‡è‰²å½©ç©ºé–“</h4>
                    <p><b>1. è¨˜æ†¶é«”å°é½Š (Memory Alignment)ï¼š</b><br>
                    æ³¨æ„ ${key('ALIGN_UP', 'ALIGN_UP(1920, 16)')}ã€‚DMA åœ¨è®€å–è¨˜æ†¶é«”æ™‚ï¼Œå¦‚æœåœ°å€æ˜¯ 16 æˆ– 32 çš„å€æ•¸ï¼Œæ•ˆç‡æœ€é«˜ã€‚æœªå°é½Šå¯èƒ½å°è‡´ Bus Errorã€‚</p>
                    <p><b>2. YUV vs RGBï¼š</b><br>
                    é¡¯ç¤ºç”¨ ${key('Sensor.YUV420SP')} æ˜¯å› ç‚ºå®ƒå£“ç¸®äº†è‰²å½©æ•¸æ“šï¼Œç¯€çœé¡¯ç¤ºé »å¯¬ã€‚AI ç”¨ ${key('Sensor.RGBP888')} (Planar) æ˜¯å› ç‚ºå¤§å¤šæ•¸ AI æ¨¡å‹æ˜¯åœ¨ RGB æ•¸æ“šé›†ä¸Šè¨“ç·´çš„ï¼Œä¸” Planar æ ¼å¼æ›´é©åˆ NPU é€²è¡ŒçŸ©é™£ä¸¦è¡Œé‹ç®—ã€‚</p>
                `
            },
            {
                id: "ai_init",
                lines: [
                    "",
                    "#-----------------------------AIæ¨¡å‹åˆå§‹åŒ–éƒ¨åˆ†-------------------------------",
                    "kmodel_path=\"/sdcard/examples/kmodel/yolov8n_224.kmodel\"",
                    "labels = [\"person\", \"bicycle\", \"car\", ...]", 
                    "model_input_size=[224,224]",
                    "confidence_threshold = 0.3",
                    "nms_threshold = 0.4",
                    "max_boxes_num = 50",
                    "colors=get_colors(len(labels))",
                    "",
                    "# åˆå§‹åŒ–ai2dé¢„å¤„ç†",
                    "ai2d=nn.ai2d()",
                    "ai2d.set_dtype(nn.ai2d_format.NCHW_FMT, nn.ai2d_format.NCHW_FMT, np.uint8, np.uint8)",
                    "top,bottom,left,right,ratio=letterbox_pad_param([AI_RGB888P_WIDTH,AI_RGB888P_HEIGHT],model_input_size)",
                    "ai2d.set_pad_param(True,[0,0,0,0,top,bottom,left,right], 0, [128,128,128])",
                    "ai2d.set_resize_param(True,nn.interp_method.tf_bilinear, nn.interp_mode.half_pixel)",
                    "ai2d_builder = ai2d.build([1,3,AI_RGB888P_HEIGHT,AI_RGB888P_WIDTH], [1,3,model_input_size[1],model_input_size[0]])",
                    "",
                    "input_init_data = np.ones((1,3,model_input_size[1],model_input_size[0]),dtype=np.uint8)",
                    "kpu_input_tensor = nn.from_numpy(input_init_data)",
                    "",
                    "# åˆ›å»ºkpuå®ä¾‹",
                    "kpu=nn.kpu()",
                    "kpu.load_kmodel(kmodel_path)"
                ],
                title: "4. è˜è«‹ä¿®åœ–å¸«èˆ‡æ•¸å­¸å®¶ (AI2D & KPU)",
                badge: "ç¡¬ä»¶åŠ é€Ÿ",
                juniorContent: `
                    <p class="info-text">
                        é€™è£¡æˆ‘å€‘åˆå§‹åŒ–äº†å…©å€‹å¼·å¤§çš„ç¡¬ä»¶åŠ©æ‰‹ï¼š
                    </p>
                    <div class="concept-card">
                        <h4>ğŸ¨ ${key('ai2d', 'nn.ai2d()')} (ä¿®åœ–å¤§å¸«)</h4>
                        <p><code>nn.ai2d()</code> æ˜¯å°ˆé–€è™•ç†åœ–ç‰‡çš„ç¡¬ä»¶ã€‚</p>
                        <p>æˆ‘å€‘å‘Šè¨´å®ƒï¼šã€Œå¾…æœƒå…’ä½ æœƒæ”¶åˆ° 1280x720 çš„åœ–ç‰‡ï¼Œè«‹å¹«æˆ‘<b>ç¸®å°</b>ä¸¦<b>å¡«å……</b> (${key('set_pad_param')}) æˆ 224x224ï¼Œç„¶å¾Œäº¤çµ¦ KPUã€‚ã€é€™ä¸€åˆ‡éƒ½æ˜¯è‡ªå‹•å®Œæˆçš„ï¼Œä¸ä½”ç”¨ CPUï¼</p>
                    </div>
                    <div class="concept-card">
                        <h4>ğŸ§  ${key('kpu', 'nn.kpu()')} (æ•¸å­¸å¤©æ‰)</h4>
                        <p><code>nn.kpu()</code> æ˜¯ AI çš„å¤§è…¦ã€‚</p>
                        <p>${key('load_kmodel')} å°±åƒæ˜¯çµ¦å¤§è…¦ä¸‹è¼‰äº†ä¸€æœ¬æ•™ç§‘æ›¸ï¼ˆYOLOv8 æ¨¡å‹ï¼‰ï¼Œè®“å®ƒå­¸æœƒå¦‚ä½•è­˜åˆ¥ 80 ç¨®ç‰©é«”ï¼ˆäººã€è»Šã€è²“ã€ç‹—...ï¼‰ã€‚</p>
                    </div>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ é€²éšåŸç†ï¼šé‡åŒ–èˆ‡é›¶æ‹·è²</h4>
                    <p><b>1. æ¨¡å‹é‡åŒ– (Quantization)ï¼š</b><br>
                    ä»£ç¢¼ä¸­ä½¿ç”¨ ${key('np.uint8')} (0-255 æ•´æ•¸) è€Œé float32ã€‚é€™æ„å‘³è‘—æ¨¡å‹ç¶“éäº†é‡åŒ–ï¼Œé›–ç„¶æå¤±äº†å¾®å°çš„ç²¾åº¦ï¼Œä½†æ¨¡å‹é«”ç©ç¸®å°äº† 4 å€ï¼Œæ¨ç†é€Ÿåº¦å¤§å¹…æå‡ã€‚</p>
                    <p><b>2. Zero-Copy (é›¶æ‹·è²)ï¼š</b><br>
                    ${key('ai2d_builder')} å»ºç«‹äº†æ•¸æ“šæµç®¡é“ã€‚åœ–åƒæ•¸æ“šç›´æ¥åœ¨ AI2D å’Œ KPU çš„å°ˆç”¨è¨˜æ†¶é«”ä¹‹é–“å‚³éï¼Œä¸éœ€è¦ CPU ä»‹å…¥é€²è¡Œ memcpyï¼Œé€™æ˜¯åµŒå…¥å¼ AI é«˜æ•ˆçš„é—œéµã€‚</p>
                `
            },
            {
                id: "main_loop_preprocess",
                lines: [
                    "",
                    "MediaManager.init()",
                    "sensor.run()",
                    "fps = time.clock()",
                    "while True:",
                    "    fps.tick()",
                    "    #------------------------ä»æ‘„åƒå¤´dumpä¸€å¸§å›¾åƒå¹¶å¤„ç†----------------------------------",
                    "    # ä»æ‘„åƒå¤´1é€šé“dumpä¸€å¸§RGB888Pæ ¼å¼çš„Imageå›¾åƒ",
                    "    img=sensor.snapshot(chn=CAM_CHN_ID_1)",
                    "    # è½¬æ¢æˆulab.numpy.ndarrayæ ¼å¼çš„æ•°æ®ï¼ŒCHW",
                    "    img_np=img.to_numpy_ref()",
                    "    # åˆ›å»ºnncase_runtime.tensorç”¨äºç»™åˆ°ai2dè¿›è¡Œé¢„å¤„ç†",
                    "    ai2d_input_tensor=nn.from_numpy(img_np)",
                    "    #------------------------æ¨ç†å‰çš„é¢„å¤„ç†æ­¥éª¤----------------------------------------",
                    "    # æ‰§è¡Œé¢„å¤„ç†è¿‡ç¨‹",
                    "    ai2d_builder.run(ai2d_input_tensor, kpu_input_tensor)"
                ],
                title: "5. ä¸»å¾ªç’°ï¼šæ‹ç…§èˆ‡ä¿®åœ–",
                badge: "é‹è¡Œéšæ®µ",
                juniorContent: `
                    <p class="info-text">
                        ç¨‹å¼é€²å…¥äº† ${key('while True')} ç„¡é™å¾ªç’°ï¼Œå°±åƒå¿ƒè‡Ÿè·³å‹•ä¸€æ¨£ï¼Œä¸€å¹€æ¥ä¸€å¹€åœ°è™•ç†ã€‚
                    </p>
                    <ol>
                        <li><b>${key('snapshot', 'sensor.snapshot')}</b>ï¼šå¾é€šé“ 1 æŠ“å–ä¸€å¼µç…§ç‰‡ï¼ˆçµ¦ AI ç”¨çš„ï¼‰ã€‚æ³¨æ„ï¼Œé€šé“ 0 çš„ç•«é¢å·²ç¶“è‡ªå‹•è·‘åˆ°å±å¹•ä¸Šäº†ï¼Œæˆ‘å€‘ä¸ç”¨ç®¡ã€‚</li>
                        <li><b>è½‰æ›æ•¸æ“š</b>ï¼šæŠŠåœ–ç‰‡è®Šæˆæ•¸å­—çŸ©é™£ (${key('to_numpy_ref')})ã€‚</li>
                        <li><b>${key('ai2d_builder.run')}</b>ï¼šä¿®åœ–å¤§å¸«é–‹å·¥ï¼æŠŠå¤§åœ–ç¬é–“è®Šæˆ KPU éœ€è¦çš„å°åœ– (Tensor)ã€‚</li>
                    </ol>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ ç¨‹å¼æŠ€å·§ï¼šå¼•ç”¨ vs æ‹·è²</h4>
                    <p><b>1. å¼•ç”¨ (Reference)ï¼š</b><br>
                    ${key('to_numpy_ref', 'img.to_numpy_ref()')} æ˜¯ä¸€å€‹æ¥µè‡´å„ªåŒ–ã€‚å®ƒä¸è¤‡è£½åœ–åƒæ•¸æ“šï¼Œåªæ˜¯å‰µå»ºäº†ä¸€å€‹æŒ‡å‘åº•å±¤ C++ è¨˜æ†¶é«”çš„ Numpy åŒ…è£å™¨ (Wrapper)ã€‚å¦‚æœé€™è£¡ç™¼ç”Ÿäº†æ•¸æ“šæ‹·è²ï¼ŒFPS å¯èƒ½æœƒæ‰ä¸€åŠã€‚</p>
                    <p><b>2. ç®¡é“ä¸¦è¡Œï¼š</b><br>
                    åœ¨ç†æƒ³æƒ…æ³ä¸‹ï¼Œç•¶ AI2D æ­£åœ¨è™•ç†ç¬¬ N å¹€æ™‚ï¼ŒSensor å·²ç¶“åœ¨æ¡é›†ç¬¬ N+1 å¹€ï¼Œå¯¦ç¾äº†æµæ°´ç·šä¸¦è¡Œã€‚</p>
                `
            },
            {
                id: "inference",
                lines: [
                    "    #------------------------ä½¿ç”¨kpuå®Œæˆæ¨¡å‹æ¨ç†--------------------------------------",
                    "    # è®¾ç½®kpuçš„ç¬¬0ä¸ªè¾“å…¥ä¸ºai2dé¢„å¤„ç†åçš„tensorï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¯ä»¥ä¾æ¬¡è®¾ç½®",
                    "    kpu.set_input_tensor(0,kpu_input_tensor)",
                    "    # åœ¨kpuä¸Šæ‰§è¡Œæ¨¡å‹æ¨ç†",
                    "    kpu.run()",
                    "    #------------------------è·å–æ¨¡å‹æ¨ç†ç»“æŸçš„è¾“å‡º----------------------------------------",
                    "    # è·å–æ¨¡å‹æ¨ç†çš„è¾“å‡ºtensorï¼Œå¹¶å°†å…¶è½¬æ¢æˆulab.numpy.ndarrayæ•°æ®è¿›è¡Œåå¤„ç†",
                    "    results=[]",
                    "    for i in range(kpu.outputs_size()):",
                    "        output_i_tensor = kpu.get_output_tensor(i)",
                    "        result_i = output_i_tensor.to_numpy()",
                    "        results.append(result_i)",
                    "        del output_i_tensor"
                ],
                title: "6. å¤§è…¦æ€è€ƒ (KPU Inference)",
                badge: "AI æ ¸å¿ƒ",
                juniorContent: `
                    <p class="info-text">
                        ç¾åœ¨è¼ªåˆ° KPU å¤§é¡¯èº«æ‰‹äº†ã€‚
                    </p>
                    <div class="concept-card">
                        <h4>âš¡ ${key('kpu.run()')}</h4>
                        <p>é€™è¡Œä»£ç¢¼åŸ·è¡Œæ™‚ï¼ŒèŠ¯ç‰‡å…§éƒ¨çš„ç¥ç¶“ç¶²çµ¡é–‹å§‹ç˜‹ç‹‚é‹ç®—ã€‚</p>
                        <p>å®ƒåœ¨åˆ†æåœ–ç‰‡è£¡çš„ç·šæ¢ã€é¡è‰²ã€ç´‹ç†ã€‚ç®—å®Œå¾Œï¼Œå®ƒæœƒåå‡ºä¸€å †æ•¸å­— (Tensor)ã€‚é€™äº›æ•¸å­—äººé¡çœ‹ä¸æ‡‚ï¼Œå®ƒå€‘ä»£è¡¨äº†ã€Œé€™è£¡å¥½åƒæœ‰äººï¼Œä¿¡å¿ƒ 80%ã€ã€ã€Œé‚£è£¡å¥½åƒæœ‰è»Šï¼Œä¿¡å¿ƒ 90%ã€ã€‚</p>
                    </div>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ æ·±åº¦å­¸ç¿’ï¼šå‰å‘å‚³æ’­</h4>
                    <p><b>1. å‰å‘å‚³æ’­ (Forward Propagation)ï¼š</b><br>
                    ${key('kpu.run()')} è§¸ç™¼äº†æ¨¡å‹çš„å‰å‘å‚³æ’­ã€‚æ•¸æ“šæµç¶“å·ç©å±¤ (Conv)ã€æ‰¹æ­¸ä¸€åŒ– (BatchNorm) å’Œæ¿€æ´»å‡½æ•¸ (SiLU)ï¼Œæå–ç‰¹å¾µåœ– (Feature Maps)ã€‚</p>
                    <p><b>2. è¼¸å‡ºå¼µé‡ï¼š</b><br>
                    YOLOv8 çš„è¼¸å‡ºé€šå¸¸åŒ…å« (Batch, 4+Classes, Anchors)ã€‚é€™è£¡çš„ ${key('get_output_tensor')} ç²å–çš„å°±æ˜¯é€™çµ„åŸå§‹çš„é æ¸¬çŸ©é™£ï¼Œéœ€è¦å¾ŒçºŒè§£ç¢¼ã€‚</p>
                `
            },
            {
                id: "post_process",
                lines: [
                    "    #------------------------æ¨ç†è¾“å‡ºçš„åå¤„ç†æ­¥éª¤----------------------------------------",
                    "    output_data=results[0][0].transpose()",
                    "    boxes_ori = output_data[:,0:4]",
                    "    class_ori = output_data[:,4:]",
                    "    class_res=np.argmax(class_ori,axis=-1)",
                    "    scores_ = np.max(class_ori,axis=-1)",
                    "    boxes,inds,scores=[],[],[]",
                    "    for i in range(len(boxes_ori)):",
                    "        if scores_[i]>confidence_threshold:",
                    "            x,y,w,h=boxes_ori[i][0],boxes_ori[i][1],boxes_ori[i][2],boxes_ori[i][3]",
                    "            x1 = int((x - 0.5 * w)/ratio)",
                    "            y1 = int((y - 0.5 * h)/ratio)",
                    "            x2 = int((x + 0.5 * w)/ratio)",
                    "            y2 = int((y + 0.5 * h)/ratio)",
                    "            boxes.append([x1,y1,x2,y2])",
                    "            inds.append(class_res[i])",
                    "            scores.append(scores_[i])",
                    "    if len(boxes)==0:",
                    "        continue",
                    "    boxes = np.array(boxes)",
                    "    scores = np.array(scores)",
                    "    inds = np.array(inds)",
                    "    # NMSè¿‡ç¨‹,å»é™¤é‡å çš„å†—ä½™æ¡†ï¼Œkeepä¸º",
                    "    keep = nms(boxes,scores,nms_threshold)",
                    "    dets = np.concatenate((boxes, scores.reshape((len(boxes),1)), inds.reshape((len(boxes),1))), axis=1)",
                    "    det_res = []",
                    "    for keep_i in keep:",
                    "        det_res.append(dets[keep_i])",
                    "    det_res = np.array(det_res)",
                    "    det_res = det_res[:max_boxes_num, :]"
                ],
                title: "7. ç¿»è­¯å¤©æ›¸ (Post-process)",
                badge: "æ•¸æ“šè™•ç†",
                juniorContent: `
                    <p class="info-text">
                        KPU åå‡ºçš„æ•¸å­—éœ€è¦ç¿»è­¯æˆæˆ‘å€‘èƒ½çœ‹æ‡‚çš„ã€Œæ¡†æ¡†ã€ã€‚
                    </p>
                    <ol>
                        <li><b>Transpose & Slice</b>ï¼šæŠŠæ•¸æ“šåˆ‡é–‹ï¼Œå‰ 4 å€‹æ•¸å­—æ˜¯ä½ç½® (x,y,w,h)ï¼Œå¾Œé¢çš„æ˜¯é¡åˆ¥åˆ†æ•¸ã€‚</li>
                        <li><b>${key('confidence_threshold', '>confidence_threshold')} (é–€æª»)</b>ï¼šå¦‚æœ AI å°æŸå€‹ç‰©é«”çš„ä¿¡å¿ƒä½æ–¼ 0.3 (30%)ï¼Œæˆ‘å€‘å°±ç•¶ä½œæ²’çœ‹è¦‹ï¼Œå¿½ç•¥å®ƒã€‚</li>
                        <li><b>åæ¨™é‚„åŸ</b>ï¼šAI æ˜¯åœ¨ 224x224 çš„å°åœ–ä¸Šçœ‹åˆ°çš„ï¼Œæˆ‘å€‘è¦é™¤ä»¥ ${key('ratio', '/ratio')}ï¼Œç®—å‡ºå®ƒåœ¨ 1280x720 å¤§åœ–ä¸Šçš„çœŸå¯¦ä½ç½®ã€‚</li>
                        <li><b>${key('nms', 'keep = nms')}</b>ï¼šå†æ¬¡å‘¼å«æˆ‘å€‘çš„ã€Œåš´æ ¼è€å¸«ã€ï¼ŒæŠŠé‡ç–Šçš„æ¡†æ¡†åˆªæ‰ã€‚</li>
                    </ol>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ ç®—æ³•æ¬Šè¡¡ï¼šé–¾å€¼èˆ‡çŸ©é™£æ“ä½œ</h4>
                    <p><b>1. é–¾å€¼æ¬Šè¡¡ (Threshold Trade-off)ï¼š</b><br>
                    ${key('confidence_threshold')} æ±ºå®šäº†æ¨¡å‹çš„éˆæ•åº¦ã€‚èª¿é«˜å®ƒï¼Œç²¾ç¢ºç‡ (Precision) è®Šé«˜ä½†å®¹æ˜“æ¼æª¢ï¼›èª¿ä½å®ƒï¼Œå¬å›ç‡ (Recall) è®Šé«˜ä½†èª¤å ±å¢åŠ ã€‚</p>
                    <p><b>2. Argmaxï¼š</b><br>
                    ${key('np.argmax', 'np.argmax(class_ori,axis=-1)')} æ˜¯ä¸€å€‹é«˜æ•ˆçš„çµ±è¨ˆå‡½æ•¸ï¼Œå®ƒèƒ½ç¬é–“åœ¨ 80 å€‹é¡åˆ¥åˆ†æ•¸ä¸­æ‰¾åˆ°åˆ†æ•¸æœ€é«˜çš„é‚£å€‹é¡åˆ¥çš„ç´¢å¼•å€¼ã€‚
                    åŒæ™‚æˆ‘å€‘ä½¿ç”¨äº† ${key('transpose', '.transpose()')} ä¾†èª¿æ•´ç¶­åº¦ä»¥ç¬¦åˆ Numpy çš„è™•ç†ç¿’æ…£ã€‚</p>
                `
            },
            {
                id: "draw_display",
                lines: [
                    "    #------------------------ç»˜åˆ¶æ£€æµ‹æ¡†ç»“æœ----------------------------------------",
                    "    osd_img.clear()",
                    "    for det in det_res:",
                    "        x_1, y_1, x_2, y_2 = map(lambda pos: int(round(pos, 0)), det[:4])",
                    "        draw_x= int(x_1 * DISPLAY_WIDTH // AI_RGB888P_WIDTH)",
                    "        draw_y= int(y_1 * DISPLAY_HEIGHT // AI_RGB888P_HEIGHT)",
                    "        draw_w = int((x_2 - x_1) * DISPLAY_WIDTH // AI_RGB888P_WIDTH)",
                    "        draw_h = int((y_2 - y_1) * DISPLAY_HEIGHT // AI_RGB888P_HEIGHT)",
                    "        osd_img.draw_rectangle(draw_x,draw_y, draw_w, draw_h, color=colors[int(det[5])],thickness=4)",
                    "        osd_img.draw_string_advanced( draw_x , max(0,draw_y-50), 24, labels[int(det[5])] + \" {0:.3f}\".format(det[4]), color=colors[int(det[5])])",
                    "    #------------------------åœ¨å±å¹•æ˜¾ç¤ºæ£€æµ‹æ¡†ç»“æœ----------------------------------------",
                    "    Display.show_image(osd_img)",
                    "    print(\"det fps:\",fps.fps())",
                    "    gc.collect()",
                    "",
                    "#é€€å‡ºå¾ªç¯ï¼Œé‡Šæ”¾èµ„æº",
                    "del ai2d",
                    "del kpu",
                    "sensor.stop()",
                    "Display.deinit()",
                    "time.sleep_ms(50)",
                    "MediaManager.deinit()",
                    "nn.shrink_memory_pool()"
                ],
                title: "8. ç•«åœ–èˆ‡å±•ç¤º (Draw & Show)",
                badge: "æœ€çµ‚æˆæœ",
                juniorContent: `
                    <p class="info-text">
                        æœ€å¾Œä¸€æ­¥ï¼
                    </p>
                    <div class="concept-card">
                        <h4>ğŸ–ï¸ åœ¨ç»ç’ƒç´™ä¸Šç•«ç•«</h4>
                        <p>${key('osd_img.clear()')}ï¼šå…ˆæŠŠä¸Šä¸€å¹€ç•«çš„æ¡†æ¡†æ“¦ä¹¾æ·¨ã€‚</p>
                        <p>ç„¶å¾Œï¼Œæˆ‘å€‘æŠŠ AI ç®—å‡ºä¾†çš„åæ¨™ï¼Œæ›ç®—æˆå±å¹•åæ¨™ (1920x1080)ï¼Œç”¨ ${key('draw_rectangle')} ç•«å‡ºå½©è‰²çš„æ¡†æ¡†ï¼Œä¸¦å¯«ä¸Šç‰©é«”çš„åå­—ï¼ˆå¦‚ "person"ï¼‰ã€‚</p>
                    </div>
                    <p class="info-text">
                        <b>${key('Display.show_image')}</b>ï¼šæŠŠé€™å¼µç•«å¥½æ¡†æ¡†çš„é€æ˜ç»ç’ƒç´™ï¼Œè“‹åœ¨æ”åƒé ­çš„ç•«é¢ä¸Šã€‚
                        <br>
                        <b>${key('gc.collect()')}</b>ï¼šæ‰“æƒè¡›ç”Ÿï¼Œæ¸…ç†å…§å­˜åƒåœ¾ï¼Œç¢ºä¿æ©Ÿå™¨ä¸æœƒè®Šæ…¢ã€‚
                    </p>
                `,
                seniorContent: `
                    <h4>ğŸ”¬ åœ–å½¢æ¸²æŸ“ï¼šAlpha Blending</h4>
                    <p><b>1. ç¡¬ä»¶åœ–å±¤ç–ŠåŠ ï¼š</b><br>
                    ${key('Display.show_image')} åˆ©ç”¨äº† K230 çš„ç¡¬ä»¶åœ–å±¤ç–ŠåŠ åŠŸèƒ½ã€‚ç¡¬ä»¶æœƒè‡ªå‹•å°‡ Video å±¤ï¼ˆæ”åƒé ­ï¼‰å’Œ OSD å±¤ï¼ˆæ¡†æ¡†ï¼‰é€²è¡Œé€æ˜åº¦æ··åˆ (Alpha Blending)ï¼Œé€™æ¯”ç”¨ CPU é€åƒç´ ä¿®æ”¹åœ–åƒå¿«å¾—å¤šï¼Œä¸”ä¸å½±éŸ¿åŸå§‹è¦–é »æµã€‚</p>
                    <p><b>2. åƒåœ¾å›æ”¶ (GC)ï¼š</b><br>
                    åœ¨åµŒå…¥å¼ Python (MicroPython) ä¸­ï¼Œé »ç¹åˆ†é…å°å°è±¡ï¼ˆå¦‚åˆ—è¡¨ã€çŸ©é™£ï¼‰æœƒå°è‡´å…§å­˜ç¢ç‰‡ã€‚${key('gc.collect()')} å¼·åˆ¶å›æ”¶å…§å­˜ï¼Œé˜²æ­¢ Out of Memory éŒ¯èª¤ã€‚</p>
                `
            }
        ];

        const codeContainer = document.getElementById('code-container');
        const infoPanel = document.getElementById('info-panel');
        let lineCounter = 1;

        // è¼”åŠ©å‡½æ•¸ï¼šæ¸…é™¤æ‰€æœ‰æŒä¹…é«˜äº®
        function clearHighlights() {
            document.querySelectorAll('.persistent-highlight').forEach(el => {
                el.classList.remove('persistent-highlight');
            });
        }

        // åˆå§‹åŒ–ä»£ç¢¼å€
        codeChunks.forEach((chunk, index) => {
            const div = document.createElement('div');
            div.className = 'code-block';
            div.dataset.index = index;
            div.id = `chunk-${index}`; 

            let html = '';
            chunk.lines.forEach(line => {
                let formattedLine = line
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;");
                // æ³¨æ„ï¼šé€™è£¡å°‡ä»£ç¢¼å…§å®¹æ”¾åœ¨ä¸€å€‹ç¨ç«‹çš„ span ä¸­ï¼Œæ–¹ä¾¿å¾ŒçºŒ JS æœç´¢
                html += `<div class="code-line"><span class="ln">${lineCounter++}</span><span class="code-text-content">${formattedLine}</span></div>`;
            });
            div.innerHTML = html;

            div.addEventListener('click', function() {
                // è¦å‰‡3ï¼šé»æ“Šä¸‹ä¸€å€‹å€å¡Šæ™‚ï¼Œæ¸…é™¤ä¹‹å‰çš„é«˜äº®
                clearHighlights();

                const isActive = this.classList.contains('active');
                document.querySelectorAll('.code-block').forEach(el => el.classList.remove('active'));
                this.classList.add('active');
                if (!isActive) {
                    updateInfoPanel(chunk);
                }
            });

            codeContainer.appendChild(div);
        });

        // æ›´æ–°å³å´é¢æ¿
        function updateInfoPanel(data) {
            infoPanel.innerHTML = `
                <div class="info-content">
                    <span class="info-badge">${data.badge}</span>
                    <h2 class="info-title">${data.title}</h2>
                    
                    <div class="junior-section">
                        ${data.juniorContent}
                    </div>

                    <div class="senior-wrapper">
                        <div class="senior-toggle" onclick="toggleSenior(this)">
                            <span>ğŸ”¬ é»æ“ŠæŸ¥çœ‹é€²éšåŸç† (é«˜ä¸­ç”Ÿ)</span>
                        </div>
                        <div class="senior-content">
                            <div class="senior-inner">
                                ${data.seniorContent}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        window.toggleSenior = function(element) {
            element.classList.toggle('open');
            const content = element.nextElementSibling;
            
            if (content.style.maxHeight) {
                // è¦å‰‡2ï¼šæ”¶èµ·é«˜ä¸­çŸ¥è­˜èœå–®æ™‚ï¼Œæ¸…é™¤é«˜äº®
                clearHighlights();
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        };

        // ä¿®å¾©å¾Œçš„é«˜äº®ä»£ç¢¼åŠŸèƒ½
        window.highlightCode = function(keyword) {
            // è¦å‰‡1ï¼šé»æ“Šä¸‹ä¸€å€‹é—œéµè©æ™‚ï¼Œå…ˆæ¸…é™¤ä¹‹å‰çš„é«˜äº®
            clearHighlights();

            const allCodeBlocks = document.querySelectorAll('.code-block');
            let found = false;

            // éæ­·æ‰€æœ‰ä»£ç¢¼å¡Š
            for (let block of allCodeBlocks) {
                if (found) break;

                // ç²å–è©²å¡Šå…§æ‰€æœ‰çš„ä»£ç¢¼è¡Œï¼ˆæ’é™¤è¡Œè™Ÿï¼‰
                const lines = block.querySelectorAll('.code-line');
                
                for (let line of lines) {
                    const contentSpan = line.querySelector('.code-text-content');
                    if (!contentSpan) continue;

                    // ç²å–ç´”æ–‡æœ¬å…§å®¹
                    const rawText = contentSpan.textContent;
                    
                    // ç°¡å–®çš„åŒ…å«æª¢æŸ¥
                    if (rawText.includes(keyword)) {
                        // å¦‚æœé—œéµè©åœ¨å¦ä¸€å€‹å€å¡Šï¼Œå…ˆåˆ‡æ›å€å¡Š
                        if (!block.classList.contains('active')) {
                            block.click();
                        }
                        
                        // æ»¾å‹•åˆ°è©²è¡Œ
                        line.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
                        
                        // æ·»åŠ é«˜äº®
                        line.classList.add('persistent-highlight');
                        found = true;
                        break; // æ‰¾åˆ°ç¬¬ä¸€å€‹åŒ¹é…é …å°±åœæ­¢
                    }
                }
            }
            
            if (!found) {
                console.warn("Keyword not found:", keyword);
            }
        };

        if (codeChunks.length > 0) {
            document.querySelector('.code-block').click();
        }

    </script>
</body>
</html>